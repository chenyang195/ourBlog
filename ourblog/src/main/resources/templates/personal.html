<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>个人中心</title>
    <link rel="stylesheet" href="layui/css/layui.css" />
    <style></style>
    <script src="layui/layui.js"></script>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript">
        function getM() {
            $.ajax({

                url:"/getMsgInfo",
                async:true,
                type:'post',
                success: function (data) {
                    if (data==""){

                        return false;
                    }
                    dataJSON = JSON.parse(data);
                    var sysNum = parseInt(dataJSON.sysNum);
                    var replyNum =parseInt(dataJSON.replyNum);
                    var personalNum =parseInt(dataJSON.personalNum);
                    var count = sysNum +replyNum+personalNum;

                    if(count>0){
                        $(".count-p").append("<span class='layui-badge'>"+count+"</span>");

                    }
                    if (sysNum>0) {
                        $(".d2").append("<span class='layui-badge'>"+sysNum+"</span>");
                    }
                    if (replyNum>0) {
                        $(".d3").append("<span class='layui-badge'>"+replyNum+"</span>");
                    }
                    if (personalNum>0) {
                        $(".d4").append("<span class='layui-badge'>"+personalNum+"</span>");
                    }

                },
                error:function () {
                    alert("暂时无法获取消息！");
                }

            });
        }

    </script>
</head>
<body class="layui-layout-body" onload="getM()">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header layui-bg-black">
        <div class="layui-logo"><i class="layui-icon layui-icon-user" style="font-size: 30px; color: #fff1fd;"></i>
            个人中心
        </div>

        <ul class="layui-nav layui-layout-left" lay-filter="">
            <li class="layui-nav-item"><a href="/">首页</a></li>
            <li class="layui-nav-item"><a href="/hotArticle">最热文章</a></li>
            <li class="layui-nav-item"><a href="/newArticleS">最新发布</a></li>
            <li shiro:hasPermission="admin:administrate" class="layui-nav-item "><a href="/admin">后台管理</a></li>
        </ul>


        <ul class="layui-nav layui-layout-right">
            <li  shiro:user="" class="layui-nav-item lay-unselect=">
                <a href="/editor"target="_Blank"><div class="layui-icon layui-icon-edit">写文章</div></a>
            </li>
            <li  shiro:user="" class="layui-nav-item layui-thislay-unselect=">
                <a href="javascript:;">
                    <img src="/getProfilePhoto" class="layui-nav-img">个人中心<span class="layui-nav-more"></span>
                </a>
                <dl class="layui-nav-child layui-anim layui-anim-upbit">
                    <dd><a href="/yourself">个人中心</a></dd>
                    <dd><a href="">私信</a></dd>
                    <dd><a href="">回复我的</a></dd>
                    <dd><a href="">系统消息</a></dd>
                    <dd><a href="/logoutme">退出登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree"  lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;R">个人资料</a>
                </li>

                <li class="layui-nav-item ">
                    <a href="javascript:;" id="showSelf">我的文章</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;"id="showReleased">已发布</a></dd>


                        <dd><a href="javascript:;" id="showDraft">草稿</a></dd>


                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;" class="count-p">消息中心</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;" id="systemMessages" class="d2">系统消息</a></dd>
                        <dd><a href="javascript:;" id="replyMe" class="d3">回复我的</a></dd>
                        <dd><a href="javascript:;" id="personalLetter " class="d4">私信</a></dd>

                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">安全中心</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;" id="LoginRecord">登录记录</a></dd>
                        <dd><a href="javascript:;" onclick=alert("测试阶段暂未开放该功能!")>修改密码</a></dd>
                        <dd><a href="javascript:;" onclick=alert("测试阶段暂未开放该功能!")>注销账号</a></dd>

                    </dl>
                </li>

            </ul>
        </div>
    </div>

    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div style="padding: 15px;">
            <div class="layui-tab layui-tab-brief" lay-filter="demo"  lay-allowClose="true">

                <ul class="layui-tab-title" id="cardtitle">
                    <li class="layui-this">个人资料</li>


                </ul>

                <div class="layui-tab-content" id="tadContent">
                    <div class="layui-tab-item layui-show">
                        个人资料

                    </div>


                </div>

            </div>

        </div>
    </div>
    <div class="layui-footer" style="background-color: white">
        <div style="text-align: center">------OURBLOG------</div>

    </div>OURBLOG
</div>
</body>

<script>
    layui.use(['layer', 'form', 'element', 'laypage', 'upload', 'tree', 'carousel', 'flow'], function(){
        var layer = layui.layer
            ,form = layui.form
            ,element = layui.element
            ,$ = layui.jquery
            ,laypage = layui.laypage
            ,upload = layui.upload
            ,tree = layui.tree
            ,carousel = layui.carousel
            ,flow = layui.flow;

        //TODO  do something
        //监听提交
        form.on('submit(submitForm)', function(data){
            layer.msg(JSON.stringify(data.field));
            return false;
        });
        var active = {
            //在这里给active绑定几项事件，后面可通过active调用这些事件
            tabAdd: function(title,content,id) {
                //新增一个Tab项 传入三个参数，分别对应其标题，tab页面的地址，还有一个规定的id，是标签中data-id的属性值
                //关于tabAdd的方法所传入的参数可看layui的开发文档中基础方法部分
                element.tabAdd('demo', {
                    title: title,
                    content:content,
                    id: id//规定好的id
                })
                element.render('tab');

            },
            tabChange: function(id) {
                //切换到指定Tab项
                element.tabChange('demo', id); //根据传入的id传入到指定的tab项
            },
            tabDelete: function (id) {
                element.tabDelete("demo", id);//删除
            },
            tabDeleteAll: function (ids) {//删除所有
                $.each(ids, function (i,item) {
                    element.tabDelete("demo", item); //ids是一个数组，里面存放了多个id，调用tabDelete方法分别删除
                })
            }
        };
        $("body").on("click", "#showRotation", function() {

            //$("#cardtitle").append("<li>管理轮播</li>")
            var title1 = "管理轮播";
            $.ajax({
                url:"/getRotation",
                async:true,
                success: function (data) {
                    if (data != "") {
                        var rotations = data.rotations
                        var addHtml="";
                        addHtml+="<div id=''class='show-rotations'><div class='rotation-title'>已有：</div>"
                        $.each(rotations,function (i,val) {

                            addHtml+="<div><hr/><br/><div class='show-rotations-img'><img class='rotation-img' src='";
                            addHtml+=val.imageSrc;
                            addHtml+="' onclick='replaceImg(this)'/></div><div class='rotation-hyperlink'><span class='rotation-hyperlink-link'>链接地址：<input type='text' class='rotation-input-text' onchange='activeButton(this)' value='" ;
                            addHtml+=val.hyperlink;
                            addHtml+="' /></span><span class='rotation-hyperlink-span'><input type='button' class='rotation-hyperlink-active' value='修改'disabled='disabled' style='font-size: 1.5625rem;' id=' " ;
                            addHtml+=val.id;
                            addHtml+="'/></span><span><input type='button' class='rotation-delete' value='删除' style='font-size: 1.5625rem;' id='";
                            addHtml+=val.id;
                            addHtml+="' /> </span></div></div>"
                        })
                        addHtml+="<div class='rotation'><div class='rotation-title'>新增：</div>";
                        addHtml+="<div><hr/><br/><div class='show-rotations-img'><img class='rotation-img' src='";
                        addHtml+="/getImage?imageName=daitianjia.jpg";
                        addHtml+="' onclick='replaceImg(this)'/></div><div class='rotation-hyperlink'><span class='rotation-hyperlink-link'>链接地址：<input type='text' class='rotation-input-text' value='" ;
                        addHtml+="#";
                        addHtml+="' /></span><span class='rotation-hyperlink-span'><input  class='rotation-hyperlink-active' type='button' value='添加'disabled='disabled' style='font-size: 1.5625rem;' id=' " ;
                        addHtml+="unknow";
                        addHtml+="'/></span></div></div></div>";
                        //$("#tadContent").append(addHtml);
                        active.tabAdd(title1,addHtml,"rotation1");
                        active.tabChange("rotation1");



                    }
                }
            });
        })
        var tablePage = laypage.render({
            elem: 'test1'
            ,count: 1000
            ,limit: 100
            ,limits: [100, 300, 500]
        });

        //执行实例
        var uploadInst = upload.render({
            elem: '#uploadFile' //绑定元素
            ,url: '/upload/' //上传接口
            ,done: function(res){
                layer.alert("回调完毕");
            }
            ,error: function(){
                layer.alert("回调异常");
            }
        });



        carousel.render({
            elem: '#carouse'
            ,width: '100%' //设置容器宽度
            ,arrow: 'always' //始终显示箭头
            //,anim: 'updown' //切换动画方式
        });

        flow.load({
            elem: '#flowTest' //指定列表容器
            ,scrollElem: '.menu-botR'
            ,done: function(page, next) { //到达临界点（默认滚动触发），触发下一页
                //模拟数据插入
                setTimeout(function(){
                    var lis = [];
                    for(var i = 0; i < 3; i++){
                        lis.push('<li>'+ ( (page-1)*8 + i + 1 ) +'</li>')
                    }

                    //执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
                    //pages为Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
                    next(lis.join(''), page < 4 ); //假设总页数为 10
                }, 500);
            }
            ,end:'到底了！'
        });

        //按屏加载图片
        flow.lazyimg({
            elem: '#flowImageTest img'
        });
    });
</script>
</html>